(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ItParallel = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ItParallel=(()=>{var h=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var x=(r,t)=>{for(var n in t)h(r,n,{get:t[n],enumerable:!0})},C=(r,t,n,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of g(t))!A.call(r,o)&&o!==n&&h(r,o,{get:()=>t[o],enumerable:!(d=b(t,o))||d.enumerable});return r};var I=r=>C(h({},"__esModule",{value:!0}),r);var O={};x(O,{default:()=>y});function a(){let r={};return r.promise=new Promise((t,n)=>{r.resolve=t,r.reject=n}),r}var c=globalThis.CustomEvent??Event;async function*y(r,t={}){let n=t.concurrency??1/0;n<1&&(n=1/0);let d=t.ordered==null?!1:t.ordered,o=new EventTarget,l=[],i=a(),f=a(),m=!1,u,v=!1;o.addEventListener("task-complete",()=>{f.resolve()}),Promise.resolve().then(async()=>{try{for await(let e of r){if(l.length===n&&(i=a(),await i.promise),v)break;let s={done:!1};l.push(s),e().then(p=>{s.done=!0,s.ok=!0,s.value=p,o.dispatchEvent(new c("task-complete"))},p=>{s.done=!0,s.err=p,o.dispatchEvent(new c("task-complete"))})}m=!0,o.dispatchEvent(new c("task-complete"))}catch(e){u=e,o.dispatchEvent(new c("task-complete"))}});function w(){return d?l[0]?.done:!!l.find(e=>e.done)}function*k(){for(;l.length>0&&l[0].done;){let e=l[0];if(l.shift(),e.ok)yield e.value;else throw v=!0,i.resolve(),e.err;i.resolve()}}function*E(){for(;w();)for(let e=0;e<l.length;e++)if(l[e].done){let s=l[e];if(l.splice(e,1),e--,s.ok)yield s.value;else throw v=!0,i.resolve(),s.err;i.resolve()}}for(;;){if(w()||(f=a(),await f.promise),u!=null)throw u;if(d?yield*k():yield*E(),m&&l.length===0)break}}return I(O);})();
return ItParallel}));
